{# step_4_8.j2 — Full ARIZ Part 4, Step 4.8: Evaluate and finalize the solution #}
{# Variables: user_input, problem_title, problem_description, previous_steps, previous_results #}

## Часть 4 — Оценка и развитие решения. Шаг 4.8: Оценка и окончательная формулировка

### Контекст:
**Задача:** {{ problem_title | default("") }}

{% if previous_results %}
**Техническое решение:** {{ previous_results.technical_solution | default("") }}
**ФП:** {{ previous_results.macro_fp | default("") }}
**ИКР-2:** {{ previous_results.ikr_2 | default("") }}
**Приёмы:** {{ previous_results.principles_applied | default("") }}
**Эффекты:** {{ previous_results.effects_applied | default("") }}
**Аналоги:** {{ previous_results.analogs | default("") }}
{% endif %}

{% if previous_steps %}
### Все шаги анализа:
{% for step in previous_steps %}
- **Шаг {{ step.step_code }}** ({{ step.title }}): {{ step.validated_result | default(step.llm_output) }}
{% endfor %}
{% endif %}

### Ввод пользователя:
{{ user_input | default("") }}

---

### Инструкция (правила 27-28):

**Шаг 4.8** — финальная оценка решения и формулировка окончательного ответа.

**1. Контрольные вопросы (правило 27):**

| Вопрос | Ответ |
|---|---|
| Решает ли решение исходную задачу? | ДА/НЕТ |
| Устраняет ли решение физическое противоречие? | ДА/НЕТ |
| Соответствует ли решение ИКР-2? | ДА/НЕТ |
| Не усложняет ли решение систему? | ДА/НЕТ |
| Не создаёт ли решение новых противоречий? | ДА/НЕТ |
| Использует ли решение имеющиеся ВПР? | ДА/НЕТ |
| Контролируемо ли решение? | ДА/НЕТ |
| Каковы затраты на реализацию? | ... |

**2. Формулировка решений (2-3 варианта):**
Для каждого решения:
- **Название:** краткое, ёмкое.
- **Описание:** как конкретно решается задача.
- **Метод ТРИЗ:** приём N / стандарт X.Y / эффект.
- **Принцип разделения:** пространство / время / структура / системный переход.
- **ВПР:** какие ресурсы задействованы.

**3. Оценка решений (10-балльная шкала):**

| Критерий | Решение 1 | Решение 2 | Решение 3 |
|---|---|---|---|
| Новизна (1-10) | ? | ? | ? |
| Реализуемость (1-10) | ? | ? | ? |
| Идеальность (1-10) | ? | ? | ? |
| Надёжность (1-10) | ? | ? | ? |
| **Средний балл** | ? | ? | ? |

**4. Обобщение (правило 28):**
- Можно ли обобщить решение для класса аналогичных задач?
- В каких ещё областях применим найденный принцип?
- Какие новые задачи могут возникнуть при внедрении?

**5. Итоговая рекомендация:**
Отранжируй решения и дай рекомендацию: какое решение реализовать в первую очередь и почему.

### Формат ответа:
```
КОНТРОЛЬНЫЕ ВОПРОСЫ:
  [ответы по каждому]

РЕШЕНИЕ 1: [Название]
  Описание: ...
  Метод: ...
  Принцип разделения: ...
  ВПР: ...
  Новизна: X/10, Реализуемость: Y/10, Идеальность: Z/10, Надёжность: W/10
  Средний балл: (X+Y+Z+W)/4

РЕШЕНИЕ 2: [Название]
  ...

РЕШЕНИЕ 3: [Название]
  ...

ОБОБЩЕНИЕ: ...

РЕКОМЕНДАЦИЯ: Реализовать решение N, потому что ...
```
