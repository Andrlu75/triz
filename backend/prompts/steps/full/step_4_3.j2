{# step_4_3.j2 -- Шаг 4.3 полного АРИЗ-2010: Применение стандартов (повторно) #}
{# Часть 4: Получение решения. Интеграция с базой знаний: аналоги, приёмы. #}
{# Переменные: user_input, problem_title, problem_description, previous_steps, previous_results #}
{# Переменные базы знаний: knowledge_base.analog_tasks, knowledge_base.principles #}

## Часть 4: Получение решения -- Шаг 4.3 из {{ total_steps | default(24) }}: Применение стандартов (повторно)

> **Правило 21 АРИЗ-2010 (В. Петров). Повторное применение системы 76 стандартов к уточнённой модели задачи из Части 3.**

### Контекст задачи:
**Задача:** {{ problem_title | default("") }}

{% if previous_results %}
**ФП макро:** {{ previous_results.fp_macro | default("") }}
**ФП микро:** {{ previous_results.fp_micro | default("") }}
**ИКР-2:** {{ previous_results.ikr_2 | default("") }}
**Модель ММЧ:** {{ previous_results.mmch_model | default("") }}
**Шаг назад от ИКР:** {{ previous_results.step_back_from_ikr | default("") }}
**ОЗ:** {{ previous_results.operative_zone | default("") }}
**ВПР:** {{ previous_results.vpr_list | default("") }}
**Стандарты из шага 1.7:** {{ previous_results.standards_applicable | default("") }}
{% endif %}

{% if previous_steps %}
### Предыдущие результаты:
{% for step in previous_steps %}
- **Шаг {{ step.step_code }}:** {{ step.validated_result | default(step.llm_output) }}
{% endfor %}
{% endif %}

{% if user_input %}
### Ввод пользователя:
{{ user_input }}
{% endif %}

{% if knowledge_base and knowledge_base.analog_tasks %}
### Задачи-аналоги из базы знаний:
{% for analog in knowledge_base.analog_tasks %}
- **{{ analog.title }}** ({{ analog.domain }}): {{ analog.problem }}
  ОП: {{ analog.op_formulation }}
  Решение: {{ analog.solution }}
{% endfor %}
{% endif %}

{% if knowledge_base and knowledge_base.principles %}
### Рекомендуемые приёмы из базы знаний:
{% for p in knowledge_base.principles %}
- **Приём {{ p.number }} -- {{ p.name }}:** {{ p.description }}
{% endfor %}
{% endif %}

---

### Задача шага 4.3: Повторно применить систему стандартов

На шаге 1.7 стандарты проверялись на основе начальной модели задачи. Теперь, после определения ФП, ИКР-2 и модели ММЧ, задача существенно уточнена. Повторная проверка стандартов может дать решение, которое не было видно ранее.

**1. Обновлённая вепольная модель:**

На основе результатов Части 3 (ФП + ИКР-2) постройте уточнённый веполь:
- **В1 (объект):** [из ФП -- элемент, к которому предъявлены противоречивые требования]
- **В2 (инструмент):** [из ФП -- или X-элемент, или модифицированный инструмент]
- **П (поле):** [физическое поле, обеспечивающее нужное действие]
- Тип веполя: полный / неполный / вредный / сложный

**2. Проверка стандартов по классам (уточнённая):**

**Класс 1 -- Построение и разрушение вепольных систем:**
- 1.1: Достройка неполного веполя (если не хватает В2 или П).
- 1.2: Разрушение вредного веполя (ввод В3 между В1 и В2; замена П).

**Класс 2 -- Развитие вепольных систем:**
- 2.1: Переход к цепному веполю (ввод промежуточного вещества В3).
- 2.2: Переход к двойному веполю (два поля).
- 2.3: Форсирование (увеличение степени дисперсности, переход к ферромагнитным веществам).

**Класс 3 -- Переход к надсистеме и на микроуровень:**
- 3.1: Объединение в бисистему (две системы с разными свойствами).
- 3.2: Переход на микроуровень (замена макро-воздействия микро-воздействием).

**Класс 4 -- Измерение и обнаружение:**
- Применим, если задача включает измерение или обнаружение.

**Класс 5 -- Вспомогательные стандарты:**
- Введение веществ/полей по особым правилам.

**3. Результат применения стандартов:**

Для каждого применимого стандарта:
- Номер и название стандарта.
- Как конкретно применить к данной задаче.
- Какое решение получается.
- Насколько оно близко к ИКР-2.

---

### Формат ответа:

```
ОБНОВЛЁННАЯ ВЕПОЛЬНАЯ МОДЕЛЬ:
  В1 (объект): [элемент]
  В2 (инструмент/X): [элемент]
  П (поле): [тип]
  Тип веполя: [полный / неполный / вредный / сложный]

ПРИМЕНИМЫЕ СТАНДАРТЫ:

  Стандарт [номер] -- [название]:
    Применение: [как конкретно]
    Решение: [что получается]
    Близость к ИКР-2: [высокая / средняя / низкая]

  Стандарт [номер] -- [название]:
    Применение: [как конкретно]
    Решение: [что получается]
    Близость к ИКР-2: [высокая / средняя / низкая]

ЛУЧШЕЕ РЕШЕНИЕ ПО СТАНДАРТАМ: [описание]
СТАНДАРТЫ НЕ ДАЮТ РЕШЕНИЯ: [если нет -- перейти к шагу 4.4]
```
